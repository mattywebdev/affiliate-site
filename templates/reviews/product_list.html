{% extends "base.html" %}
{% block content %}

<h1>Product List</h1>

<form method="get" style="display:flex; gap:12px; align-items:center; margin:12px 0;">
  <input type="text" name="q" placeholder="Search..." value="{{ q }}">
  <select name="sort">
    <option value="name" {% if sort == "name" %}selected{% endif %}>Name (A–Z)</option>
    <option value="-name" {% if sort == "-name" %}selected{% endif %}>Name (Z–A)</option>
    <option value="price" {% if sort == "price" %}selected{% endif %}>Price (low → high)</option>
    <option value="-price" {% if sort == "-price" %}selected{% endif %}>Price (high → low)</option>
  </select>

  <select name="cat">
    <option value="">All categories</option>
    {% for c in nav_categories %}
      <option value="{{ c.slug }}" {% if cat == c.slug %}selected{% endif %}>{{ c.name }}</option>
    {% endfor %}
  </select>

  <button type="submit">Apply</button>
</form>

<div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:16px;">
  {% for product in products %}
<div style="border:1px solid #ddd; padding:14px; border-radius:12px;">
  {% if product.image %}
    <a href="{% url 'reviews:product_detail' product.slug %}">
      <img src="{{ product.image.url }}" alt="{{ product.name }}"
           style="width:100%; height:170px; object-fit:cover; border-radius:12px;">
    </a>
  {% endif %}

  <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start; margin-top:10px;">
    <h2 style="margin:0; font-size:20px; line-height:1.2;">
      <a href="{% url 'reviews:product_detail' product.slug %}">{{ product.name }}</a>
    </h2>

    <div style="white-space:nowrap;">
      {% include "reviews/_stars.html" with rating=product.rating %}
    </div>
  </div>

  <div style="display:flex; justify-content:space-between; align-items:center; margin:8px 0 10px;">
    <div style="color:#555; font-size:14px;">
      {% if product.category %}
        <a href="{% url 'reviews:category_detail' product.category.slug %}">{{ product.category.name }}</a>
      {% else %}
        <span>Uncategorized</span>
      {% endif %}
    </div>
    <div style="font-weight:700;">£{{ product.price }}</div>
  </div>

  <p style="margin:0 0 10px; color:#333;">
    {{ product.description|truncatechars:110 }}
  </p>

  <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin:10px 0 12px;">
    <div style="border:1px solid #eee; border-radius:10px; padding:10px;">
      <div style="font-weight:700; margin-bottom:6px;">Pros</div>
      {% if product.pros %}
        <ul style="margin:0; padding-left:18px;">
          {% for line in product.pros.splitlines %}
            {% if line %}<li>{{ line }}</li>{% endif %}
          {% endfor %}
        </ul>
      {% else %}
        <div style="color:#777;">—</div>
      {% endif %}
    </div>

    <div style="border:1px solid #eee; border-radius:10px; padding:10px;">
      <div style="font-weight:700; margin-bottom:6px;">Cons</div>
      {% if product.cons %}
        <ul style="margin:0; padding-left:18px;">
          {% for line in product.cons.splitlines %}
            {% if line %}<li>{{ line }}</li>{% endif %}
          {% endfor %}
        </ul>
      {% else %}
        <div style="color:#777;">—</div>
      {% endif %}
    </div>
  </div>

  <div style="display:flex; gap:10px; align-items:center;">
    <a href="{% url 'reviews:affiliate_redirect' product.slug %}" target="_blank" rel="noopener"
       style="padding:10px 12px; border:1px solid #2e9b45; border-radius:10px; text-decoration:none;">
      Buy on Amazon →
    </a>

    <a href="{% url 'reviews:product_detail' product.slug %}" style="text-decoration:none;">
      Details
    </a>
  </div>
</div>
  {% empty %}
    <p>No products found.</p>
  {% endfor %}
</div>

<div style="margin-top:16px; display:flex; gap:12px; align-items:center;">
  {% if page_obj.has_previous %}
    <a href="?q={{ q }}&sort={{ sort }}&cat={{ cat }}&page={{ page_obj.previous_page_number }}">Prev</a>
  {% endif %}

  <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

  {% if page_obj.has_next %}
    <a href="?q={{ q }}&sort={{ sort }}&cat={{ cat }}&page={{ page_obj.next_page_number }}">Next</a>
  {% endif %}
</div>

{% endblock %}
